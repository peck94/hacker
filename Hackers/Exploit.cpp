//
//  Exploit.cpp
//  Hackers
//
//  Created by Jonathan Peck on 26/07/15.
//  Copyright (c) 2015 Jonathan Peck. All rights reserved.
//

#include "Exploit.h"
using namespace std;

Exploit::Exploit(string name, Vulnerability v, unsigned int level): Program(name) {
    this->vuln = v;
    this->level = level;
}

Vulnerability Exploit::getVuln() {
    return vuln;
}

void Exploit::launch(Host* host, vector<string> args) {
    // check args
    if(args.size() < 4) {
        cout << "Please specify an IP and port to exploit." << endl;
        return;
    }
    
    // resolve ip
    string ip = args[2];
    if(!host->ping(ip)) {
        cout << "Destination host unreachable." << endl;
        return;
    }
    
    Host *remote = host->resolve(ip);
    
    // check level
    unsigned int port = stoi(args[3]);
    Service *s = remote->getService(port);
    if(!s->isVuln(vuln)) {
        cout << "Service is not vulnerable." << endl;
        return;
    }
    if(s->getVersion() > level) {
        cout << "Exploit level too low: must be " << s->getVersion() << ", is " << level << "." << endl;
        return;
    }
    
    // exploit the vuln
    run(host, remote, port);
}